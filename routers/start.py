from aiogram import Router, types, F
from aiogram.filters import Command

from keyboards.start_kb import start_keyboard, continue_keyboard
from keyboards.pay_kb import payment_keyboard
from services.storage import set_unsubscribed

router = Router()

# 1Ô∏è‚É£ /start
@router.message(Command("start"))
async def start_cmd(message: types.Message):
    text = (
        "üéâ *–í—ñ—Ç–∞—î–º–æ!*\n"
        "–í–∏ –ø—ñ–¥–ø–∏—Å–∞–ª–∏—Å—è –Ω–∞ –±–æ—Ç *FinanceForTeens*!\n\n"
        "–¶–µ –∫—É—Ä—Å –∑ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—ñ. –í—ñ–Ω —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —Ç–∏—Ö –º—Ä—ñ–π–Ω–∏–∫—ñ–≤, "
        "—è–∫—ñ —Ö–æ—á—É—Ç—å –±—ñ–ª—å—à–µ –∑–Ω–∞—Ç–∏ –ø—Ä–æ –≥—Ä–æ—à—ñ —Ç–∞ –≤–ø–µ–≤–Ω–µ–Ω–æ —Ä—É—Ö–∞—Ç–∏—Å—è –¥–æ —Å–≤–æ—ó—Ö —Ü—ñ–ª–µ–π.\n\n"
        "–ù—É —è–∫, —Ü—ñ–∫–∞–≤–æ? üòâ"
    )
    await message.answer(
        text,
        reply_markup=start_keyboard(),
        parse_mode="Markdown"
    )


# 2Ô∏è‚É£ –ù–∞—Ç–∏—Å–Ω—É–ª–∏ ‚Äú‚ú® –¢–∞–∫, —Ö–æ—á—É –¥–∞–ª—ñ!‚Äù
@router.callback_query(F.data == "start_yes")
async def show_course_description(callback: types.CallbackQuery):
    text = (
        "–ö—É—Ä—Å —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∏–π –Ω–∞ –ø—ñ–¥–ª—ñ—Ç–∫—ñ–≤ 14‚Äì19 —Ä–æ–∫—ñ–≤.\n"
        "–£ –Ω—å–æ–º—É –ø–æ—î–¥–Ω–∞–Ω—ñ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∞ –≥—Ä–∞–º–æ—Ç–Ω—ñ—Å—Ç—å, –æ—Å–Ω–æ–≤–∏ –ø—ñ–¥–ø—Ä–∏—î–º–Ω–∏—Ü—Ç–≤–∞, "
        "–ª–æ–≥—ñ–∫–∞ —Ç–∞ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—è.\n\n"
        "–ó–∞–Ω—è—Ç—Ç—è –ø–æ–±—É–¥–æ–≤–∞–Ω—ñ —É —Ñ–æ—Ä–º–∞—Ç—ñ ¬´–≤—ñ–¥ –ø—Ä–æ—Å—Ç–æ–≥–æ –¥–æ —Å–∫–ª–∞–¥–Ω–æ–≥–æ¬ª, —â–æ–± –¥–æ–ø–æ–º–æ–≥—Ç–∏:\n"
        "‚Ä¢ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ —Å–≤–æ—ó —Ü—ñ–ª—ñ\n"
        "‚Ä¢ –ø–æ–±–∞—á–∏—Ç–∏ —à–ª—è—Ö —ó—Ö –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è\n"
        "‚Ä¢ –Ω–∞–¥–∏—Ö–Ω—É—Ç–∏—Å—è —ñ—Å—Ç–æ—Ä—ñ—è–º–∏ —É—Å–ø—ñ—à–Ω–∏—Ö –ª—é–¥–µ–π\n\n"
        "–ü—Ä–æ–¥–æ–≤–∂–∏–º–æ? üëâ"
    )
    await callback.message.edit_text(
        text,
        reply_markup=continue_keyboard()
    )
    await callback.answer()  # –∑–∞–∫—Ä–∏–≤–∞—î "–≥–æ–¥–∏–Ω–Ω–∏–∫" –Ω–∞ –∫–Ω–æ–ø—Ü—ñ


# 3Ô∏è‚É£ –ù–∞—Ç–∏—Å–Ω—É–ª–∏ ‚Äúüëâ –¢–∞–∫, –ø—Ä–æ–¥–æ–≤–∂–∏–º–æ!‚Äù ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ —Ç–∞—Ä–∏—Ñ—ñ–≤
@router.callback_query(F.data == "cont_yes")
async def continue_after_intro(callback: types.CallbackQuery):
    text = (
        "üëá –£ –Ω–∞—Å —î –¥–µ–∫—ñ–ª—å–∫–∞ —Ñ–æ—Ä–º–∞—Ç—ñ–≤, –æ–±–µ—Ä—ñ—Ç—å —Ç–æ–π, —â–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –≤–∞–º –Ω–∞–π–±—ñ–ª—å—à–µ.\n\n"
        "üíé *A) –ü–æ–≤–Ω–∞ –æ–ø–ª–∞—Ç–∞ ‚Äî 1500 –≥—Ä–Ω*\n"
        "–ö—É—Ä—Å –∑ 12 —É—Ä–æ–∫—ñ–≤, –¥–æ—Å—Ç—É–ø –Ω–∞–∑–∞–≤–∂–¥–∏.\n\n"
        "üí≥ *B) –û–ø–ª–∞—Ç–∞ —á–∞—Å—Ç–∏–Ω–∞–º–∏ ‚Äî 800 –≥—Ä–Ω*\n"
        "–î–æ—Å—Ç—É–ø –¥–æ –ø–µ—Ä—à–∏—Ö 6 —É—Ä–æ–∫—ñ–≤ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –ø–ª–∞—Ç–µ–∂—É.\n\n"
        "üî• *C) PRO –¥–æ—Å—Ç—É–ø ‚Äî 2000 –≥—Ä–Ω*\n"
        "–ü–æ–≤–Ω–∏–π –∫—É—Ä—Å + –º–µ–Ω—Ç–æ—Ä—Å—å–∫–∏–π —Å—É–ø—Ä–æ–≤—ñ–¥ 1 –º—ñ—Å—è—Ü—å.\n\n"
        "üëë *D) MAX-–ø—Ä–æ–≥—Ä–∞–º–∞ ‚Äî 3490 –≥—Ä–Ω*\n"
        "–ü–æ–≤–Ω–∏–π –∫—É—Ä—Å + –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –º–æ–¥—É–ª—ñ + —Å–ø—ñ–ª—å–Ω–æ—Ç–∞ + —Ñ—ñ–¥–±–µ–∫.\n\n"
        "–ü—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏ –º–∏ –ø–æ–ø—Ä–æ—Å–∏–º–æ –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É —Ç–∞ –Ω–∞–¥—ñ—à–ª–µ–º–æ –¥–æ—Å—Ç—É–ø –¥–æ –∫—É—Ä—Å—É. üíõ"
    )
    await callback.message.edit_text(
        text,
        reply_markup=payment_keyboard(),
        parse_mode="Markdown"
    )
    await callback.answer()


# 4Ô∏è‚É£ –ù–∞—Ç–∏—Å–Ω—É–ª–∏ ‚Äú‚ùå –ù—ñ, –≤—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å‚Äù
@router.callback_query(F.data == "start_no")
async def unsubscribe(callback: types.CallbackQuery):
    user_id = callback.from_user.id
    set_unsubscribed(user_id, True)

    await callback.message.edit_text(
        "–î–æ–±—Ä–µ! –Ø–∫—â–æ –ø–µ—Ä–µ–¥—É–º–∞—î—Ç–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à—ñ—Ç—å /start üß°"
    )
    await callback.answer("–í–∏ –≤—ñ–¥–ø–∏—Å–∞–ª–∏—Å—è –≤—ñ–¥ –±–æ—Ç–∞.")
